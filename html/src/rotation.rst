.. |exb| mathmacro:: \mathbf{E}\times\mathbf{B}

PLASMA ROTATION
===============

Physical considerations
-----------------------

Sonic rotation can arise in tokamaks from torque due to neutral beam injection.  It is
believed to play an important role in the suppression of turbulence and the formation of
transport barriers through :math:`\exb` shear.  In addition, it
produces a strong centrifugal force that pushes ions toroidally outward, causing them to
redistribute nonuniformly around a flux surface.  As a result of quasi-neutrality, a
poloidally-varying electrostatic potential is generated by the electrons to balance the
density asymmetry.  This generates **centrifugal drifts** in addition to the
usual :math:`\exb` rotation, Coriolis drift, and parallel velocity shear.
Because of their complexity, these centrifugal effects, which are second-order in the main
ion Mach number, are ignored in most neoclassical and gyrokinetic codes.  Inclusion of full
sonic rotation effects is particularly critical for studying transport of heavy impurities,
as the influence of the centrifugal force is amplified by their large mass.

Sonic rotation formalism
------------------------

The rigorous derivation of the gyrokinetic equations for sonic rotation was carried out by Sugama
:cite:`sugama:1998`.  Sugama followed the underlying rotation formulation of Hinton
and Wong :cite:`hinton:1985`, who showed that in an axisymmetric system the
zeroth-order flow velocity is

.. math::

   \mathbf{U}_0 = \omega_0(\psi) R^2 \nabla \varphi \; .

It is this scalar flux-function, :math:`\omega_0`, that is the true free (input) function in
neoclassical and gyrokinetic theory.  Here, :math:`\psi` is the poloidal flux.

The rotation profile
--------------------

The relevant profile that gives a *complete specification of rotation*
is the potential :math:`\omega_0(r)`, which in defined consistently throughout
GACODE as

.. math::

   \omega_0(r) = -c \frac{d \Phi}{d \psi} \simeq \frac{c E_r }{R B_p} \; .

In the strictest sense, :math:`\Phi(r)` above is the leading-order potential :math:`\Phi(r)_{_1}`
that is constant on a flux surface.  Because the meaning of :math:`\Phi(r)_{-1}` is ambiguous in
an experimental sense, it is perhaps most useful to rely on the final approximate expression in
terms of :math:`E_r`.  We believe this form is intuitively appealing and connects most clearly
with experimental data.   These issue are described in full detail in the papers of Hinton and
Sugama.

Input parameters
----------------

CGYRO and NEO implement *full sonic rotation* (GYRO implements only a reduced model) according to the
formulation of Hinton and Wong [Phys. Fluids 28, 3082 (1985)].  Neoclassically, the induced poloidally-varying
electrostatic potential leads to the formation of potential wells.  In the banana regime these increase
the effective trapped particle fraction, and in the Pfirsh-Schluter regime increase the effective toroidal
curvature.  In both instances, this may lead to enhanced neoclassical transport.  The code inputs are

.. csv-table::
   :header: "input.cgyro parameter", "Definition", "Description"
   :widths: 10, 15, 15

   ":ref:`cgyro_gamma_e`",":math:`\displaystyle \frac{a}{c_s} \, \gamma_{\rm E} \doteq -\frac{r}{q}\frac{\partial \omega_{0}}{\partial r}`",":math:`\exb` shearing rate" 
   ":ref:`cgyro_gamma_p`",":math:`\displaystyle \frac{a}{c_s} \, \gamma_p \doteq -R_0\frac{\partial \omega_{0}}{\partial r}`","rotation shearing rate" 
   ":ref:`cgyro_mach`",":math:`\displaystyle M \doteq \frac{\omega_0 R_0}{c_s}`","rotation shearing rate" 

.. csv-table::
   :header: "input.neo parameter", "Definition", "Description"
   :widths: 10, 15, 15

   ":ref:`neo_omega_rot`",":math:`\displaystyle  \frac{a}{v_{norm}} \omega_0`","rotation rate" 
   ":ref:`neo_omega_rot_deriv`",":math:`\displaystyle \frac{a^{2}}{v_{norm}} \frac{d \omega_{0}}{dr}`","derivative of rotation rate" 

Theoretical basis for sonic rotation
------------------------------------

In presence of rapid rotation, where the flow speed :math:`U` is allowed to be of the order of the ion thermal speed, the Lorentz
force term in the the Fokker-Planck equation (see :cite:`hinton:1985`)

.. math::

   \frac{\partial f_i}{\partial t} + \mathbf{v} \cdot \nabla f_i + \frac{e}{m_i}(\mathbf{E}+\mathbf{v} \times \mathbf{B})
   \cdot \frac{\partial f_i}{\partial \mathbf{v}} = C_i + S_i

becomes the leading term.  Under these circumstances Hinton and Wong show that

.. math::

    \mathbf{E}_{-1} + \frac{\mathbf{U}_0}{c} \times \mathbf{B} = 0

where the subscripts represents the order with respect to the **drift ordering** in :math:`\rho_i/a`.
Here :math:`\mathbf{U}_0` is a purely toroidal velocity and is species independent.  This ordering is applied to
all fields and moments

.. math::

   \begin{align}
   f_i  & = ~~~~~~~~~~~ f_{i,0} + f_{i,1} + \ldots \\
   \Phi & = \Phi_{-1} + \Phi_0 + \Phi_1 + \ldots \\
   \mathbf{U} & = ~~~~~~~~~~~ \mathbf{U}_0 + \mathbf{U}_1 + \ldots \\
   U_\varphi & =  ~~~~~~~~~~~ U_{\varphi,0} + U_{\varphi,1} + \ldots \\
   U_\theta  & =  ~~~~~~~~~~~~~~~~~~~~~~ U_{\theta,1} + \ldots 
   \end{align}

where :math:`U_\varphi \doteq \mathbf{e}_\varphi \cdot \mathbf{U}` and :math:`U_\theta \doteq \mathbf{e}_\theta \cdot \mathbf{U}`.
The leading-order sonic flow is toroidal and independent of species
   
.. math::

   \mathbf{U}_0 = \omega_0 R \, \mathbf{e}_{\varphi} \quad \text{where} \quad
   \omega_{0} \doteq -c \frac{\partial \Phi_{-1}}{\partial \psi}

It is important to note that :math:`\Phi_{-1}` is a **flux function**, whereas higher orders are not constant on a flux surface.
We also remark that :math:`\omega_{0}` is a **theoretical quantity** that cannot be measured in the experiment.  This is similar
to the observation that the experimentally-measured temperature :math:`T` is approximately equal to the (theoretical) thermal
temperature :math:`T_0` only if the plasma is close to thermal

.. math::

    T = T_0 + T_1 + \ldots \\

With this analogy in mind we can understand why when the plasma is in a sonic regime, :math:`\omega_0` is
approximately equal to :math:`\exb` component of the perpendicular rotation frequency (which can be measured experimentally):

.. math::

    E_r \simeq E_{r,-1} = -|\nabla r| \frac{\partial \Phi_{-1}}{\partial r}

So, in the **sonic regime**

.. math::

    \omega_0 & = \frac{c E_{r,-1}}{R B_{p}} \simeq \frac{c E_{r}}{R B_{p}} \\
    \omega_1 & = \frac{c E_{r,0}}{R B_{p}} \simeq  0 

When the plasma is in the **weak rotation regime**, then we have

.. math::

    \omega_0 & = \frac{c E_{r,-1}}{R B_{p}} \simeq 0  \\
    \omega_1 & = \frac{c E_{r,0}}{R B_{p}} \approx \frac{c E_{r}}{R B_{p}} 

Let us stress how :math:`\omega_0` and :math:`\omega_1` are two different orders of :math:`\omega` and they are not the
same quantity.  The reader should not be mislead by the fact that both :math:`\omega_0` and :math:`\omega_1` can be
approximately equal to the experimental toroidal frequency, since that occurs for two opposite rotation regimes:
sonic rotation and weak rotation, respectively.
